/**
 * è¿™é‡Œæƒ³è¦é‡ç‚¹è®²çš„æ˜¯ replace é‡Œé¢çš„ ç¬¬äºŒä¸ªå‚æ•°çš„ä½¿ç”¨
 * 
 * ECMAScriptè§„å®šï¼Œreplaceï¼ˆï¼‰æ–¹æ³•çš„å‚æ•°replacementå¯ä»¥æ˜¯å‡½æ•°è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚
 * åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåŒ¹é…éƒ½è°ƒç”¨è¯¥å‡½æ•°ï¼Œå®ƒè¿”å›çš„å­—ç¬¦ä¸²å°†æ›¿æ¢æ–‡æœ¬ä½¿ç”¨ã€‚
 * ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºåŒ¹é…åˆ°çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºåŒ¹é…åˆ°çš„å­—ç¬¦æœ€å°ç´¢å¼•ä½ç½®ï¼ˆRegExp.indexï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºè¢«åŒ¹é…çš„å­—ç¬¦ä¸²ï¼ˆRegExp.inputï¼‰
 */

// 1ã€ç¬¬ä¸€ä¸ªæ —å­
let str = 'DR Mobile å®éªŒå®¤@ - {{ msg }} - {{zoom}}'
let reg = /\{\{(.*?)\}\}/g

reg.test(str)
// è¿™ä¸ªç‰¹æ€§ä¹Ÿéœ€è¦å¥½å¥½å­¦ä¹ 
RegExp.$1 // msg

str.replace(reg, (matched, placeholder) => {
  console.log(matched) // {{ msg }}  å’Œ {{zoom}}
  console.log(placeholder) // msg  å’Œ zoom
  // è¿™é‡Œå¿…é¡»è¿”å›ä¸€ä¸ªå…·ä½“çš„æ›¿ä»£çš„æ•°å€¼ï¼Œå¦è€…é»˜è®¤å°±æ˜¯ç”¨ undefined å»æ›¿ä»£
  // è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¸ªæ€§æ›¿æ¢
  return '#' + placeholder + '$'
})

/* å…·ä½“è¾“å‡º */

// {{ msg }}
// msg 
// {{zoom}}
// zoom
// "DR Mobile å®éªŒå®¤@ - # msg $ - #zoom$"

/**
 * å¦‚æœæ˜¯è¿™æ ·
 * å°‘äº†ä¸€ä¸ªé—®å· ï¼Ÿ
 * ï¼Ÿ æ˜¯éè´ªå©ªæ¨¡å¼ï¼Œå°±æ˜¯å°½å¯èƒ½å°‘çš„åŒ¹é…å­—ç¬¦
 */
str.replace(/\{\{(.*)\}\}/g, (matched, placeholder) => {
  console.log(matched) // {{ msg }}  å’Œ {{zoom}}
  console.log(placeholder) // msg  å’Œ zoom
  return '#' + placeholder + '$'
})
// {{ msg }} - {{zoom}} è¿™æ˜¯ å®Œæ•´çš„å­—ç¬¦åŒ¹é…åˆ°çš„å­—ç¬¦
// msg }} - {{zoom  è¿™æ˜¯ p ï¼ˆæ‹¬å·é‡Œé¢çš„æ­£åˆ™åŒ¹é…åˆ°çš„å­—ç¬¦ï¼‰

/*
* æ–°API matchAll
* ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰çš„åŒ¹é…ç»“æœã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªè¿­ä»£å‡½æ•°
*ğŸ¥«ğŸ¥«ğŸ¥«ğŸ¥«ğŸ¥«ğŸ¥«ğŸ¥«ğŸ¥«ğŸ¥«
*/
// ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦å¯¹éå†å™¨ï¼ˆiteratorï¼‰è¿›è¡Œç»“æ„
// [...str.matchAll(/\{\{(.*)\}\}/g)]

//æˆ–è€…ä½¿ç”¨ from ç›´æ¥è½¬ä¸ºæ•°ç»„
Array.from(str.matchAll(/\{\{(.*)\}\}/g))


// ç¬¬äºŒä¸ªæ —å­ğŸŒ°ğŸŒ°ğŸŒ°ğŸŒ°ğŸŒ°ğŸŒ°ğŸŒ°
let template = '(xxx) xxx-xxxx'
template.replace(/x/g, (m, p) => {
  console.log(m, p)
})
// x 1
// x 2
// ...
// x 10
// x 11
// x 12

/**
 * æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢ æœ‰æ²¡æœ‰æ‹¬å·æ˜¯ä¸ä¸€æ ·çš„ã€‚
 * å¸¦æœ‰ æ‹¬å·ï¼ˆï¼‰ ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ æ‹¬å·é‡Œé¢åŒ¹é…åˆ°çš„å­—ç¬¦
 */
template.replace(/(x)/g, (m, p) => {
  console.log(m, p)
  return '#'
})
// x x
// x x

/**
 * æ€»ç»“ä¸€ä¸‹ï¼š
 * éœ€è¦å¥½å¥½ç†è§£ ä¸‰ä¸ªå‚æ•°
 * 1ã€åŒ¹é…åˆ°çš„å­—ç¬¦
 * 2ã€åŒ¹é…åˆ°çš„å­—ç¬¦çš„ç´¢å¼•ä½ç½®  ï¼ˆç¬¬äºŒä¸ªä¾‹å­å°±æ˜¯è¾“å‡ºäº† ç´¢å¼•ï¼‰
 * 3ã€è¢«åŒ¹é…çš„å­—ç¬¦ä¸²  ï¼ˆç¬¬ä¸€ä¸ªæ —å­å°±æ˜¯è¾“å‡ºäº† åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ï¼‰
 */

let arr = [1,2,3,4,5,6,7,8,9,0]
template.replace(/x/g, m => arr.shift())
// "(123) 456-7890"


/** 
 * åˆ†ç±»
 * å°†ç‰ˆæœ¬åŒºé—´å’Œç‰ˆæœ¬å·åŒºåˆ†å‡ºæ¥ 
*/
let str_ver = `"VerCmp(ota.ver, "5.2.3.6") == 0 && VerCmp(ota.ver, "8.2.3.6") = 0 
                && (VerCmp(ota.ver, "5.1.2.3") >= 0 && VerCmp(ota.ver, "5.4.3.6") <= 0) 
                && (VerCmp(ota.ver, "2.5.6.9") >= 0 && VerCmp(ota.ver, "2.6.1.5") <= 0) 
                && IPIn("city", "å‘¼å’Œæµ©ç‰¹") && IPIn("city", "å—äº¬")"`

// ç‰ˆæœ¬åŒºé—´
str.match(/(\d(\.\d)+)\W+=/g).filter(item => !item.endsWith(') =')).map(item => item.match(/(\d(\.\d)+)/g)[0])
// ç‰ˆæœ¬å·
str.match(/(\d(\.\d)+)\W+=/g).filter(item => item.endsWith(') =')).map(item => item.match(/(\d(\.\d)+)/g)[0])

str.match(/(\d(\.\d)+)\W+=/g).filter(item => /\)\s*=+$/.test(item)).map(item => item.match(/(\d(\.\d)+)/g)[0])


/** 
 * å°†æ±‰å­—æ¯éš”ä¸¤ä¸ªåŠ ä¸€ä¸ªé€—å·
*/
let str_zn = "ç”¨æˆ·å¤„ç†ä¸šåŠ¡ç±»"

// æ–¹æ³•ä¸€
str.replace(/[\u4e00-\u9fa5]{2}\B/g, m => m+',')
// "ç”¨æˆ·,å¤„ç†,ä¸šåŠ¡,ç±»"

// æ–¹æ³•äºŒ
str.split('').reduce((p,c,i) => {
  console.log(i)  // æ²¡æœ‰åˆå§‹å€¼ï¼Œindex ä»1å¼€å§‹
  if((i+1) % 2 == 0) {
   return p + c + ','
  }
  return p + c
})
