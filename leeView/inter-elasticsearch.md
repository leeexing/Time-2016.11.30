---
title: elaticsearch
tag: db bigdata
---

## å¯åŠ¨

1. elasticsearch.bat
2. grunt server
3. localshot:9100 // å¯è§†åŒ–å®¢æˆ·ç«¯
4. localshot:9200 // restful api æœåŠ¡

## å¸¸è§é—®é¢˜æˆ–æŸ¥è¯¢

### è·å–esæ‰€æœ‰çš„ç´¢å¼•åˆ—è¡¨

es.indices.get_alias('*)

## ä¼˜åŠ¿ã€ç‰¹ç‚¹

1ï¼‰å¯ä»¥ä½œä¸ºä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼é›†ç¾¤ï¼ˆæ•°ç™¾å°æœåŠ¡å™¨ï¼‰æŠ€æœ¯ï¼Œå¤„ç†PBçº§æ•°æ®ï¼ŒæœåŠ¡å¤§å…¬å¸ï¼›ä¹Ÿå¯ä»¥è¿è¡Œåœ¨å•æœºä¸Šï¼ŒæœåŠ¡å°å…¬å¸
2ï¼‰Elasticsearchä¸æ˜¯ä»€ä¹ˆæ–°æŠ€æœ¯ï¼Œä¸»è¦æ˜¯å°†å…¨æ–‡æ£€ç´¢ã€æ•°æ®åˆ†æä»¥åŠåˆ†å¸ƒå¼æŠ€æœ¯ï¼Œåˆå¹¶åœ¨äº†ä¸€èµ·ï¼Œæ‰å½¢æˆäº†ç‹¬ä¸€æ— äºŒçš„ESï¼›luceneï¼ˆå…¨æ–‡æ£€ç´¢ï¼‰ï¼Œå•†ç”¨çš„æ•°æ®åˆ†æè½¯ä»¶ï¼ˆä¹Ÿæ˜¯æœ‰çš„ï¼‰ï¼Œåˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆmycatï¼‰
3ï¼‰å¯¹ç”¨æˆ·è€Œè¨€ï¼Œæ˜¯å¼€ç®±å³ç”¨çš„ï¼Œéå¸¸ç®€å•ï¼Œä½œä¸ºä¸­å°å‹çš„åº”ç”¨ï¼Œç›´æ¥3åˆ†é’Ÿéƒ¨ç½²ä¸€ä¸‹ESï¼Œå°±å¯ä»¥ä½œä¸ºç”Ÿäº§ç¯å¢ƒçš„ç³»ç»Ÿæ¥ä½¿ç”¨äº†ï¼Œæ•°æ®é‡ä¸å¤§ï¼Œæ“ä½œä¸æ˜¯å¤ªå¤æ‚
4ï¼‰æ•°æ®åº“çš„åŠŸèƒ½é¢å¯¹å¾ˆå¤šé¢†åŸŸæ˜¯ä¸å¤Ÿç”¨çš„ï¼ˆäº‹åŠ¡ï¼Œè¿˜æœ‰å„ç§è”æœºäº‹åŠ¡å‹çš„æ“ä½œï¼‰ï¼›ç‰¹æ®Šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚å…¨æ–‡æ£€ç´¢ï¼ŒåŒä¹‰è¯å¤„ç†ï¼Œç›¸å…³åº¦æ’åï¼Œå¤æ‚æ•°æ®åˆ†æï¼Œæµ·é‡æ•°æ®çš„è¿‘å®æ—¶å¤„ç†ï¼›Elasticsearchä½œä¸ºä¼ ç»Ÿæ•°æ®åº“çš„ä¸€ä¸ªè¡¥å……ï¼Œæä¾›äº†æ•°æ®åº“æ‰€ä¸ä¸èƒ½æä¾›çš„å¾ˆå¤šåŠŸèƒ½

## ESåŸºæœ¬æ¦‚å¿µ

### è§£å†³ä»€ä¹ˆé—®é¢˜

ESä¸»è¦è§£å†³é—®é¢˜ï¼š
1ï¼‰æ£€ç´¢ç›¸å…³æ•°æ®ï¼›
2ï¼‰è¿”å›ç»Ÿè®¡ç»“æœï¼›
3ï¼‰é€Ÿåº¦è¦å¿«ã€‚

### ESæ ¸å¿ƒæ¦‚å¿µ

1ï¼‰Clusterï¼šé›†ç¾¤ã€‚
ESå¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å•ä¸ªæœç´¢æœåŠ¡å™¨ã€‚ä¸è¿‡ï¼Œä¸ºäº†å¤„ç†å¤§å‹æ•°æ®é›†ï¼Œå®ç°å®¹é”™å’Œé«˜å¯ç”¨æ€§ï¼ŒESå¯ä»¥è¿è¡Œåœ¨è®¸å¤šäº’ç›¸åˆä½œçš„æœåŠ¡å™¨ä¸Šã€‚è¿™äº›æœåŠ¡å™¨çš„é›†åˆç§°ä¸ºé›†ç¾¤ã€‚

2ï¼‰Nodeï¼šèŠ‚ç‚¹ã€‚
å½¢æˆé›†ç¾¤çš„æ¯ä¸ªæœåŠ¡å™¨ç§°ä¸ºèŠ‚ç‚¹ã€‚

3ï¼‰Shardï¼šåˆ†ç‰‡ã€‚
å½“æœ‰å¤§é‡çš„æ–‡æ¡£æ—¶ï¼Œç”±äºå†…å­˜çš„é™åˆ¶ã€ç£ç›˜å¤„ç†èƒ½åŠ›ä¸è¶³ã€æ— æ³•è¶³å¤Ÿå¿«çš„å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ç­‰ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸å¤Ÿã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®å¯ä»¥åˆ†ä¸ºè¾ƒå°çš„åˆ†ç‰‡ã€‚æ¯ä¸ªåˆ†ç‰‡æ”¾åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚
å½“ä½ æŸ¥è¯¢çš„ç´¢å¼•åˆ†å¸ƒåœ¨å¤šä¸ªåˆ†ç‰‡ä¸Šæ—¶ï¼ŒESä¼šæŠŠæŸ¥è¯¢å‘é€ç»™æ¯ä¸ªç›¸å…³çš„åˆ†ç‰‡ï¼Œå¹¶å°†ç»“æœç»„åˆåœ¨ä¸€èµ·ï¼Œè€Œåº”ç”¨ç¨‹åºå¹¶ä¸çŸ¥é“åˆ†ç‰‡çš„å­˜åœ¨ã€‚å³ï¼šè¿™ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ã€‚

4ï¼‰Repliaï¼šå‰¯æœ¬ã€‚
ä¸ºæé«˜æŸ¥è¯¢ååé‡æˆ–å®ç°é«˜å¯ç”¨æ€§ï¼Œå¯ä»¥ä½¿ç”¨åˆ†ç‰‡å‰¯æœ¬ã€‚
å‰¯æœ¬æ˜¯ä¸€ä¸ªåˆ†ç‰‡çš„ç²¾ç¡®å¤åˆ¶ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ã€‚ESä¸­å¯ä»¥æœ‰è®¸å¤šç›¸åŒçš„åˆ†ç‰‡ï¼Œå…¶ä¸­ä¹‹ä¸€è¢«é€‰æ‹©æ›´æ”¹ç´¢å¼•æ“ä½œï¼Œè¿™ç§ç‰¹æ®Šçš„åˆ†ç‰‡ç§°ä¸ºä¸»åˆ†ç‰‡ã€‚
å½“ä¸»åˆ†ç‰‡ä¸¢å¤±æ—¶ï¼Œå¦‚ï¼šè¯¥åˆ†ç‰‡æ‰€åœ¨çš„æ•°æ®ä¸å¯ç”¨æ—¶ï¼Œé›†ç¾¤å°†å‰¯æœ¬æå‡ä¸ºæ–°çš„ä¸»åˆ†ç‰‡ã€‚

5ï¼‰å…¨æ–‡æ£€ç´¢ã€‚
å…¨æ–‡æ£€ç´¢å°±æ˜¯å¯¹ä¸€ç¯‡æ–‡ç« è¿›è¡Œç´¢å¼•ï¼Œå¯ä»¥æ ¹æ®å…³é”®å­—æœç´¢ï¼Œç±»ä¼¼äºmysqlé‡Œçš„likeè¯­å¥ã€‚

### ESæ•°æ®æ¶æ„çš„ä¸»è¦æ¦‚å¿µï¼ˆä¸å…³ç³»æ•°æ®åº“Mysqlå¯¹æ¯”ï¼‰

#### 6.x ä¹‹å‰çš„ç‰ˆæœ¬

ï¼ˆ1ï¼‰å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®åº“ï¼ˆDataBaseï¼‰ï¼Œç­‰ä»·äºESä¸­çš„ç´¢å¼•ï¼ˆIndexï¼‰
ï¼ˆ2ï¼‰ä¸€ä¸ªæ•°æ®åº“ä¸‹é¢æœ‰Nå¼ è¡¨ï¼ˆTableï¼‰ï¼Œç­‰ä»·äº1ä¸ªç´¢å¼•Indexä¸‹é¢æœ‰Nå¤šç±»å‹ï¼ˆTypeï¼‰ï¼Œ
ï¼ˆ3ï¼‰ä¸€ä¸ªæ•°æ®åº“è¡¨ï¼ˆTableï¼‰ä¸‹çš„æ•°æ®ç”±å¤šè¡Œï¼ˆROWï¼‰å¤šåˆ—ï¼ˆcolumnï¼Œå±æ€§ï¼‰ç»„æˆï¼Œç­‰ä»·äº1ä¸ªTypeç”±å¤šä¸ªæ–‡æ¡£ï¼ˆDocumentï¼‰å’Œå¤šFieldç»„æˆã€‚
ï¼ˆ4ï¼‰åœ¨ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“é‡Œé¢ï¼Œschemaå®šä¹‰äº†è¡¨ã€æ¯ä¸ªè¡¨çš„å­—æ®µï¼Œè¿˜æœ‰è¡¨å’Œå­—æ®µä¹‹é—´çš„å…³ç³»ã€‚ ä¸ä¹‹å¯¹åº”çš„ï¼Œåœ¨ESä¸­ï¼šMappingå®šä¹‰ç´¢å¼•ä¸‹çš„Typeçš„å­—æ®µå¤„ç†è§„åˆ™ï¼Œå³ç´¢å¼•å¦‚ä½•å»ºç«‹ã€ç´¢å¼•ç±»å‹ã€æ˜¯å¦ä¿å­˜åŸå§‹ç´¢å¼•JSONæ–‡æ¡£ã€æ˜¯å¦å‹ç¼©åŸå§‹JSONæ–‡æ¡£ã€æ˜¯å¦éœ€è¦åˆ†è¯å¤„ç†ã€å¦‚ä½•è¿›è¡Œåˆ†è¯å¤„ç†ç­‰ã€‚
ï¼ˆ5ï¼‰åœ¨æ•°æ®åº“ä¸­çš„å¢insertã€åˆ deleteã€æ”¹updateã€æŸ¥searchæ“ä½œç­‰ä»·äºESä¸­çš„å¢PUT/POSTã€åˆ Deleteã€æ”¹_updateã€æŸ¥GET

#### 7.x æœ€æ–°çš„ç‰ˆæœ¬(åˆ é™¤äº†type)

ç´¢å¼•ï¼ˆindicesï¼‰--------------------------------æ•°æ®åº“

æ–‡æ¡£ï¼ˆDocumentï¼‰----------------Row è¡Œ

å­—æ®µï¼ˆFieldï¼‰-------------------Columns åˆ—

ç´¢å¼•åº“ï¼ˆindices) --- indicesæ˜¯indexçš„å¤æ•°ï¼Œä»£è¡¨è®¸å¤šçš„ç´¢å¼•ï¼Œ
æ–‡æ¡£ï¼ˆdocumentï¼‰--- å­˜å…¥ç´¢å¼•åº“åŸå§‹çš„æ•°æ®ã€‚æ¯”å¦‚æ¯ä¸€æ¡å•†å“ä¿¡æ¯ï¼Œå°±æ˜¯ä¸€ä¸ªæ–‡æ¡£
å­—æ®µï¼ˆfieldï¼‰--- æ–‡æ¡£ä¸­çš„å±æ€§
æ˜ å°„é…ç½®ï¼ˆmappingsï¼‰--- å­—æ®µçš„æ•°æ®ç±»å‹ã€å±æ€§ã€æ˜¯å¦ç´¢å¼•ã€æ˜¯å¦å­˜å‚¨ç­‰ç‰¹æ€§

ç´¢å¼•é›†ï¼ˆIndicesï¼Œindexçš„å¤æ•°ï¼‰ï¼šé€»è¾‘ä¸Šçš„å®Œæ•´ç´¢å¼•
åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šæ•°æ®æ‹†åˆ†åçš„å„ä¸ªéƒ¨åˆ†
å‰¯æœ¬ï¼ˆreplicaï¼‰ï¼šæ¯ä¸ªåˆ†ç‰‡çš„å¤åˆ¶
è¦æ³¨æ„çš„æ˜¯ï¼šElasticsearchæœ¬èº«å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå› æ­¤å³ä¾¿ä½ åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒElasticsearché»˜è®¤ä¹Ÿä¼šå¯¹ä½ çš„æ•°æ®è¿›è¡Œåˆ†ç‰‡å’Œå‰¯æœ¬æ“ä½œï¼Œå½“ä½ å‘é›†ç¾¤æ·»åŠ æ–°æ•°æ®æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šåœ¨æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸­è¿›è¡Œå¹³è¡¡ã€‚

**Index**
Elasticsearch ä¼šç´¢å¼•æ‰€æœ‰å­—æ®µï¼Œç»è¿‡å¤„ç†åå†™å…¥ä¸€ä¸ªåå‘ç´¢å¼•ï¼ˆInverted Indexï¼‰ã€‚æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥æŸ¥æ‰¾è¯¥ç´¢å¼•ã€‚

æ‰€ä»¥ï¼ŒElasticsearch æ•°æ®ç®¡ç†çš„é¡¶å±‚å•ä½å°±å«åš Indexï¼ˆç´¢å¼•ï¼‰ï¼Œå…¶å®å°±ç›¸å½“äº MySQLã€MongoDB ç­‰é‡Œé¢çš„æ•°æ®åº“çš„æ¦‚å¿µã€‚å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ª Index ï¼ˆå³æ•°æ®åº“ï¼‰çš„åå­—å¿…é¡»æ˜¯å°å†™ã€‚

### ELKæ˜¯ä»€ä¹ˆ

ELK = elasticsearch + Logstash + kibana
elasticsearchï¼šåå°åˆ†å¸ƒå¼å­˜å‚¨ä»¥åŠå…¨æ–‡æ£€ç´¢
logstash: æ—¥å¿—åŠ å·¥ã€â€œæ¬è¿å·¥â€
kibanaï¼šæ•°æ®å¯è§†åŒ–å±•ç¤ºã€‚
ELKæ¶æ„ä¸ºæ•°æ®åˆ†å¸ƒå¼å­˜å‚¨ã€å¯è§†åŒ–æŸ¥è¯¢å’Œæ—¥å¿—è§£æåˆ›å»ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç®¡ç†é“¾ã€‚ ä¸‰è€…ç›¸äº’é…åˆï¼Œå–é•¿è¡¥çŸ­ï¼Œå…±åŒå®Œæˆåˆ†å¸ƒå¼å¤§æ•°æ®å¤„ç†å·¥ä½œã€‚

### ESç‰¹ç‚¹å’Œä¼˜åŠ¿

1ï¼‰åˆ†å¸ƒå¼å®æ—¶æ–‡ä»¶å­˜å‚¨ï¼Œå¯å°†æ¯ä¸€ä¸ªå­—æ®µå­˜å…¥ç´¢å¼•ï¼Œä½¿å…¶å¯ä»¥è¢«æ£€ç´¢åˆ°ã€‚
2ï¼‰å®æ—¶åˆ†æçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ã€‚
åˆ†å¸ƒå¼ï¼šç´¢å¼•åˆ†æ‹†æˆå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªæ•°æ®èŠ‚ç‚¹éƒ½å¯æ‰¿è½½ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ï¼Œå¹¶ä¸”åè°ƒå’Œå¤„ç†å„ç§æ“ä½œï¼›
è´Ÿè½½å†å¹³è¡¡å’Œè·¯ç”±åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è‡ªåŠ¨å®Œæˆã€‚
3ï¼‰å¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®ã€‚ä¹Ÿå¯ä»¥è¿è¡Œåœ¨å•å°PCä¸Šï¼ˆå·²æµ‹è¯•ï¼‰
4ï¼‰æ”¯æŒæ’ä»¶æœºåˆ¶ï¼Œåˆ†è¯æ’ä»¶ã€åŒæ­¥æ’ä»¶ã€Hadoopæ’ä»¶ã€å¯è§†åŒ–æ’ä»¶ç­‰ã€‚

## åŸºæœ¬ä½¿ç”¨

### åˆ›å»ºç´¢å¼•åº“ï¼ˆæ•°æ®åº“ï¼‰

"number_of_shards": 1 åˆ†ç‰‡æ•°
"number_of_replicas": 1 å‰¯æœ¬æ•°

```js
PUT people
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1
  }

}

// return
{
  "acknowledged" : true,
  "shards_acknowledged" : true,
  "index" : "people"
}
```

### æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯

``` JS
http://localhost:9200/_cat/indices?v
```

### åˆ ç´¢å¼•åº“

```js
DELETE people
```

### æŸ¥è¯¢ç´¢å¼•åº“

```JS
GET  people

ç»“æœï¼š

{
  "people" : {
    "aliases" : { },
    "mappings" : { },
    "settings" : {
      "index" : {
        "creation_date" : "1564308107803",
        "number_of_shards" : "1",
        "number_of_replicas" : "1",
        "uuid" : "zQYt9-BXR9yuQOLNugAabg",
        "version" : {
          "created" : "7020099"
        },
        "provided_name" : "item"
      }
    }
  }
}
```

## æŸ¥è¯¢ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨

``` JS
HEAD people

è¿”å›

200 - OK
```

### åˆ›å»ºæ˜ å°„å…³ç³»(æ•°æ®åº“åˆ—) ğŸ‘

typeï¼šç±»å‹ï¼Œå¯ä»¥æ˜¯textã€longã€shortã€dateã€integerã€objectç­‰
indexï¼šæ˜¯å¦ç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue. æ˜¯falseï¼›ä¸ä¼šä¸ºè¯¥å€¼åˆ›å»ºç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯æ— æ³•å½“ä½œä¸»æŸ¥è¯¢æ¡ä»¶
storeï¼šæ˜¯å¦å­˜å‚¨ï¼Œé»˜è®¤ä¸ºfalse
analyzerï¼šåˆ†è¯å™¨ï¼Œè¿™é‡Œçš„ik_max_wordå³ä½¿ç”¨ikåˆ†è¯å™¨
copy_to: è¯¥å±æ€§å…è®¸æˆ‘ä»¬å°†å¤šä¸ªå­—æ®µçš„å€¼å¤åˆ¶åˆ°ç»„å­—æ®µä¸­ï¼Œç„¶åå°†ç»„å­—æ®µä½œä¸ºå•ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢

REFER: https://blog.csdn.net/abc123lzf/article/details/102957060

text
textç±»å‹é€‚ç”¨äºéœ€è¦è¢«å…¨æ–‡æ£€ç´¢çš„å­—æ®µï¼Œä¾‹å¦‚æ–°é—»æ­£æ–‡ã€é‚®ä»¶å†…å®¹ç­‰æ¯”è¾ƒé•¿çš„æ–‡å­—ã€‚textç±»å‹ä¼šè¢«Luceneåˆ†è¯å™¨ï¼ˆAnalyzerï¼‰å¤„ç†ä¸ºä¸€ä¸ªä¸ªè¯é¡¹ï¼Œå¹¶ä½¿ç”¨Luceneå€’æ’ç´¢å¼•å­˜å‚¨ã€‚textå­—æ®µä¸èƒ½è¢«ç”¨äºæ’åºã€‚å¦‚æœéœ€è¦ä½¿ç”¨è¯¥ç±»å‹çš„å­—æ®µåªéœ€è¦åœ¨å®šä¹‰æ˜ å°„æ—¶æŒ‡å®šJSONä¸­å¯¹åº”å­—æ®µçš„typeä¸ºtextã€‚

keyword
keywordé€‚åˆç®€çŸ­ã€ç»“æ„åŒ–å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ä¸»æœºåã€å§“åã€å•†å“åç§°ç­‰ï¼Œå¯ä»¥ç”¨äºè¿‡æ»¤ã€æ’åºã€èšåˆæ£€ç´¢ï¼Œä¹Ÿå¯ä»¥ç”¨äºç²¾ç¡®æŸ¥è¯¢ã€‚

``` JS
PUT people/_mapping

{
  "properties": {
    "name": {
      "type": "text",
      "analyzer": "ik_max_word"
    },
    "age": {
      "type": "integer",
      "index": "false"
    },
    "sex": {
      "type": "keyword"
    }
  }
}
```

å¦‚æœå†æ¬¡åˆ›å»ºä¸é€šè¯æ˜ å°„åˆ™ä¸ºæ–°å¢æ˜ å°„

### æŸ¥è¯¢æ˜ å°„å…³ç³»

```js
GET people/_mapping

{
  "people" : {
    "mappings" : {
      "properties" : {
        "age" : {
          "type" : "integer",
          "index" : false
        },
        "name" : {
          "type" : "text",
          "analyzer" : "ik_max_word"
        },
        "sex" : {
          "type" : "keyword"
        }
      }
    }
  }
}
```

### æ·»åŠ  æ›´æ–°æ•°æ®

å¦‚æœ_doc åé¢ä¸æŒ‡å®šidæ•° ä¼šé»˜è®¤ç”Ÿæˆéšæœºid

``` JS
POST people/_doc/1
{
  "name" : "å°æ˜",
  "age" : 18,
  "sex": "ç”·"
}
```

ä½¿ç”¨ç›¸åŒçš„ä»£ç æ›´æ”¹éƒ¨åˆ† å³å¯æ›´æ”¹

``` JS
POST people/_doc/1
{
  "name" : "å°çº¢",
  "age" : 18,
  "sex": "å¥³"
}
```

### è·å–æ•°æ®

``` JS
GET people/_doc/1

æˆ–è€…æŸ¥è¯¢æ‰€æœ‰

GET people/_search
```

### åˆ é™¤æ•°æ®

é€šè¿‡æŸ¥è¯¢idè¿›è¡Œåˆ é™¤å³å¯

```js
DELETE people/_doc/1
```

### æŸ¥è¯¢åŠŸèƒ½

#### å…¨éƒ¨æŸ¥è¯¢

``` JS
GET /ç´¢å¼•åº“å/_search
{
    "query":{
        "æŸ¥è¯¢ç±»å‹":{
            "æŸ¥è¯¢æ¡ä»¶":"æŸ¥è¯¢æ¡ä»¶å€¼"
        }
    }
}

// or

GET people/_search
{
  "query": {
    "match_all": {}
  }
}
```

#### åŒ¹é…æŸ¥è¯¢

> full-text searchï¼ˆå…¨æ–‡æ£€ç´¢ï¼‰

``` JS
GET people/_search
{
  "query": {
    "match": {
      "name": "å°ç‹2"
    }
  }
}

// åŒ¹é…producerä¸­åŒ…å«yagao å’Œ producerçš„æ•°æ®
{
  "query" : {
    "match" : {
      "producer" : "yagao producer"
    }
  }
}

// å¦‚æœæˆ‘ä»¬åªæƒ³è¦å°ç‹2 åˆ™é€šè¿‡æ›´æ”¹å…³è”å…³ç³»(æ­¤æ—¶æˆ‘ä»¬åªèƒ½æŸ¥è¯¢åˆ°å°ç‹2)

GET people/_search
{
  "query": {
    "match": {
      "name":{"query": "å°ç‹2","operator": "and"}
    }
  }
}
```

**phrase searchï¼ˆçŸ­è¯­æœç´¢ï¼‰**
ä¸å…¨æ–‡æ£€ç´¢ç›¸åï¼Œå…¨æ–‡æ£€ç´¢ä¼šå°†è¾“å…¥çš„æœç´¢ä¸²æ‹†è§£å¼€æ¥ï¼Œå»å€’æ’ç´¢å¼•é‡Œé¢å»ä¸€ä¸€åŒ¹é…ï¼Œåªè¦èƒ½åŒ¹é…ä¸Šä»»æ„ä¸€ä¸ªæ‹†è§£åçš„å•è¯ï¼Œå°±å¯ä»¥ä½œä¸ºç»“æœè¿”å›

phrase searchï¼Œè¦æ±‚è¾“å…¥çš„æœç´¢ä¸²ï¼Œå¿…é¡»åœ¨æŒ‡å®šçš„å­—æ®µæ–‡æœ¬ä¸­ï¼Œå®Œå…¨åŒ…å«ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ‰å¯ä»¥ç®—åŒ¹é…ï¼Œæ‰èƒ½ä½œä¸ºç»“æœè¿”å›

``` Python
GET /ecommerce/product/_search
{
    "query" : {
        "match_phrase" : {
            "producer" : "yagao producer"
        }
    }
}
```

**highlight searchï¼ˆé«˜äº®æœç´¢ç»“æœï¼‰**ï¼š

``` Python
GET /ecommerce/product/_search
{
    "query" : {
        "match" : {
            "producer" : "producer"
        }
    },
    "highlight": {
        "fields" : {
          "pre_tags": "<b style='color: red;'>",
          "post_tags: "</b>",
          "producer" : {}
        }
    }
}
```

### è®¾ç½®æœ€å°åŒ¹é…åº¦æŸ¥è¯¢

å¦‚æœæ»¡è¶³å…¶ä¸­çš„50% å²‚å¯è§†ä¸ºæŸ¥è¯¢æ­£ç¡® å°ç‹å’Œå°ç‹2éƒ½ä¼šæŸ¥è¯¢å‡ºæ¥
å¦‚æœè®¾ç½®ä¸º100% åˆ™åªä¼šæŸ¥å‡ºå°ç‹2

``` JS
GET people/_search
{
  "query": {
    "match": {
      "name":{"query": "å°ç‹2","minimum_should_match": "50%"}
    }
  }
}
```

#### å¤šå­—æ®µæŸ¥è¯¢

æˆ‘ä»¬åœ¨sex å’Œnameä¸­æŸ¥è¯¢å¸¦ â€œç”·â€å­— çš„ä¿¡æ¯

```js
GET people/_search
{
  "query": {
    "multi_match": {
      "query": "ç”·",
      "fields": ["name","sex"]
    }
  }
}
```

#### è¯æ¡åŒ¹é…ï¼ˆç²¾ç¡®æŸ¥æ‰¾ï¼‰

term æŸ¥è¯¢è¢«ç”¨äºç²¾ç¡®å€¼ åŒ¹é…ï¼Œè¿™äº›ç²¾ç¡®å€¼å¯èƒ½æ˜¯æ•°å­—ã€æ—¶é—´ã€å¸ƒå°”æˆ–è€…é‚£äº›æœªåˆ†è¯çš„å­—ç¬¦ä¸²
terms å°±æ˜¯æŸ¥è¯¢å¤šä¸ª

``` JS
GET people/_search
{
 "query": {
   "terms": {
     "sex": [
       "ç”·","å¥³"
     ]
   }
 }
```

#### terms å’Œ match çš„åŒºåˆ«

termå’Œmatchçš„åŒºåˆ«:

matchæ˜¯ç»è¿‡åˆ†æ(analyer)çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡æ¡£æ˜¯å…ˆè¢«åˆ†æå™¨å¤„ç†äº†ï¼Œæ ¹æ®ä¸åŒçš„åˆ†æå™¨ï¼Œåˆ†æå‡ºçš„ç»“æœä¹Ÿä¼šä¸åŒï¼Œåœ¨ä¼šæ ¹æ®åˆ†è¯ ç»“æœè¿›è¡ŒåŒ¹é…ã€‚
termæ˜¯ä¸ç»è¿‡åˆ†è¯çš„ï¼Œç›´æ¥å»å€’æ’ç´¢å¼•æŸ¥æ‰¾ç²¾ç¡®çš„å€¼ã€‚

ğŸ‘keyword å­—æ®µç±»å‹ä¸ä¼šè¢«åˆ†æå™¨åˆ†æ

#### ç»“æœè¿‡æ»¤

æˆ‘ä»¬åªéœ€è¦nameå­—æ®µ

``` JS
GET people/_search
{

  "query": {
    "terms": {
      "sex": [
        "ç”·","å¥³"
      ]
    }
  },"_source": "name"
}

// æˆ‘ä»¬ä¸éœ€è¦å¸¦æœ‰age çš„ä¿¡æ¯
GET people/_search
{

  "query": {
    "terms": {
      "sex": [
        "ç”·","å¥³"
      ]
    }
  },"_source": {
    "excludes": "age"
  }
}

// æˆ‘ä»¬åªéœ€è¦æ€§åˆ«å’Œåå­—
GET people/_search
{

  "query": {
    "terms": {
      "sex": [
        "ç”·","å¥³"
      ]
    }
  },"_source": {
    "includes": ["name","sex"]
  }
}

```

### TIP: èšåˆæŸ¥è¯¢

REFER: https://blog.csdn.net/alex_xfboy/article/details/86100037

``` Python
"aggregations" : {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //ä¹Ÿå¯ç®€å†™ä¸º aggs
Â  Â  "<aggregation_name>" : {Â  Â  Â  //èšåˆçš„åå­—
Â  Â  Â  Â  "<aggregation_type>" : {Â  Â  Â //èšåˆçš„ç±»å‹
Â  Â  Â  Â  Â  Â  <aggregation_body>Â  Â  Â  //èšåˆä½“ï¼šå¯¹å“ªäº›å­—æ®µè¿›è¡Œèšåˆ
Â  Â  Â  Â  }
Â  Â  Â  Â  [,"meta" : { Â [<meta_data_body>] } ]?Â  Â  Â  Â  Â  Â  Â  Â  Â //å…ƒ
Â  Â  Â  Â  [,"aggregations" : { [<sub_aggregation>]+ } ]?Â  Â //åœ¨èšåˆé‡Œé¢åœ¨å®šä¹‰å­èšåˆ
Â  Â  }
Â  Â  [,"<aggregation_name_2>" : { ... } ]*Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //èšåˆçš„åå­—
}
```


å¯¹åç§°ä¸­åŒ…å«yagaoçš„å•†å“ï¼Œè®¡ç®—æ¯ä¸ªtagä¸‹çš„å•†å“æ•°é‡

å‰æï¼š å°†æ–‡æœ¬fieldçš„fielddataå±æ€§è®¾ç½®ä¸ºtrue

``` Python
PUT /ecommerce/_mapping/product
{
  "properties": {
    "tags": {
      "type": "text",
      "fielddata": true
    }
  }
}
```

``` Python
GET /ecommerce/product/_search
{
  "size": 0, # ğŸˆä¸æŸ¥è¯¢å‡ºæ•°æ®ï¼Œåªç»Ÿè®¡
  "query": {
    "match": {
      "name": "yagao"
    }
  },
  "aggs": {
    "all_tags": {
      "terms": {
        "field": "tags"
      }
    }
  }
}
```

### èŒƒå›´èšåˆ

GET http://{{hostname}}:9201/people/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "size": 0,
  "query": {
    "match_all": {}
  },
  "aggs": {
    "test_missing": {
      "range": {
        "field": "age",
        "ranges": [
          {
            "from": 10,
            "to": 30
          }
        ]
      }
    }
  }
}

### BoolæŸ¥è¯¢

Bool Queryï¼ŒBool æŸ¥è¯¢ç”¨boolæ“ä½œæ¥ç»„åˆå¤šä¸ªæŸ¥è¯¢å­—å¥ä¸ºä¸€ä¸ªæŸ¥è¯¢ã€‚æ˜ å°„LuceneÂ BooleanQueryã€‚

boolæŸ¥è¯¢ä¸boolè¿‡æ»¤å™¨ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼Œè¿‡æ»¤å™¨åšäºŒå…ƒåˆ¤æ–­ï¼šæ–‡æ¡£æ˜¯å¦åº”è¯¥å‡ºç°åœ¨ç»“æœä¸­ï¼Ÿä½†æŸ¥è¯¢æ›´ç²¾å¦™ï¼Œå®ƒé™¤äº†å†³å®šä¸€ä¸ªæ–‡æ¡£æ˜¯å¦åº”è¯¥è¢«åŒ…æ‹¬åœ¨ç»“æœä¸­ï¼Œè¿˜ä¼šè®¡ç®—æ–‡æ¡£çš„ç›¸å…³ç¨‹åº¦ã€‚

bool æŸ¥è¯¢ä¼šä¸ºæ¯ä¸ªæ–‡æ¡£è®¡ç®—ç›¸å…³åº¦è¯„åˆ† _score ï¼Œ å†å°†æ‰€æœ‰åŒ¹é…çš„ must å’Œ should è¯­å¥çš„åˆ†æ•° _score æ±‚å’Œï¼Œæœ€åé™¤ä»¥ must å’Œ should è¯­å¥çš„æ€»æ•°

**å¯ç”¨çš„å…³é”®å­—**ï¼š

must      ä¸ANDç­‰ä»·ï¼Œå¹¶æœ‰åŠ©äºå¾—åˆ†
filter    å¿…é¡»åŒ¹é…ï¼Œä½†å®ƒåœ¨ Filterä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œä¸å½±å“è¯„åˆ†
should    ä¸ORç­‰ä»·
must_not  ä¸NOTç­‰ä»·ï¼Œåœ¨ Filterä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œä¸å½±å“è¯„åˆ†

``` Python
POST _search
{
Â Â "query": {
Â Â Â Â "bool" : {
Â Â Â Â Â Â "must" : {
Â Â Â Â Â Â Â Â "term" : { "user" : "kimchy" }
Â Â Â Â Â Â },
Â Â Â Â Â Â "filter": {
Â Â Â Â Â Â Â Â "term" : { "tag" : "tech" }
Â Â Â Â Â Â },
Â Â Â Â Â Â "must_not" : {
Â Â Â Â Â Â Â Â "range" : {
Â Â Â Â Â Â Â Â Â Â "age" : { "gte" : 10, "lte" : 20 }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â },
Â Â Â Â Â Â "should" : [
Â Â Â Â Â Â Â Â { "term" : { "tag" : "wow" } },
Â Â Â Â Â Â Â Â { "term" : { "tag" : "elasticsearch" } }
Â Â Â Â Â Â ],
Â Â Â Â Â Â "minimum_should_match" : 1,
Â Â Â Â Â Â "boost" : 1.0
Â Â Â Â }
Â Â }
}
```

``` Python
GET _search
{
Â  "query": {
Â  Â  "bool": {
Â  Â  Â  "filter": { // åœ¨filterå…ƒç´ ä¸‹æŒ‡å®šçš„æŸ¥è¯¢å¯¹å¾—åˆ†æ²¡æœ‰å½±å“ - å¾—åˆ†è¿”å›ä¸º0
Â  Â  Â  Â  "term": {
Â  Â  Â  Â  Â  "status": "active"
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  }
}
```

``` Python
GET _search
{
Â  "query": {
Â  Â  "bool": {
Â  Â  Â  "must": { // æœ‰ä¸€ä¸ªmatch_allæŸ¥è¯¢ï¼Œå®ƒä¸ºæ‰€æœ‰æ–‡æ¡£æŒ‡å®š1.0åˆ†
Â  Â  Â  Â  "match_all": {}
Â  Â  Â  },
Â  Â  Â  "filter": {
Â  Â  Â  Â  "term": {
Â  Â  Â  Â  Â  "status": "active"
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  }
}
```

### åŸºæœ¬ç»“æ„

``` Python
{
   "query":{
      "bool":{
          "must":{
          },
          "must_not":{},
          "filter":{},
          "should":{},
          "should_not":{}
       }
  }
}
```

### æ•°ç»„æŸ¥è¯¢

``` Python
{
    "query":{
          "nested":{
                 "path":"firm_app",
                 "query":{
                 "match":{
                     "firm_app.app":"noticias"
                  }
              }
         }
    }
}

# or
GET my_index/_search
{
  "query": {
    "nested": {
      "path": "user",
      "query": {
        "bool": {
          "must": [
            { "match": { "user.first": "Alice" }},
            { "match": { "user.last":  "White" }}
          ]
        }
      }
    }
  }
}
```

### å¯¹è±¡æŸ¥è¯¢

``` Python
{
   "query":{
        "term":{
              "language.v4.keyword": "Spanish"
        }
   }
}
```

## è·¯ç”±

ç¡®ä¿æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢éƒ½åœ¨åŒä¸€å—åˆ†ç‰‡ä¸Šï¼Œæå‡æŸ¥è¯¢æ•ˆç‡

``` Python
PUT topic/_doc/1?routing=user1
{
  "name": "leeee"
}

# æŸ¥è¯¢è·¯ç”±ä¸Šçš„æ‰€æœ‰æ•°æ®

GET topic/_doc/_search
{
  "query: {
    "terms": {
      "_routing": ["user1"]
    }
  }
}
```

è¿™æ ·å­˜å‚¨åï¼Œåˆ é™¤æ–‡æ¡£ä¹Ÿéœ€è¦å¸¦ä¸Š è·¯ç”±çš„åç§°

### esåˆ«å

REFER: https://www.cnblogs.com/Neeo/articles/10897280.html

åˆ›å»ºåˆ«å

``` Python
POST /_aliases
{
  "actions": [
    {
      "add": {
        "index": "topic",
        "alias": "my_topic"
      }
    }
  ]
}

```

æŸ¥è¯¢åˆ«å

``` Python
GET topic/_alias
```

åˆ é™¤åˆ«å

``` Python
POST /_aliases
{
  "actions": [
    {
      "remove": {
        "index": "topic",
        "alias": "my_topic"
      }
    }
  ]
}
```

## python æ“ä½œ

### è¿æ¥

``` Python
# æŒ‡å®šè¿æ¥
es = Elasticsearch(
    ['172.16.153.129:9200'],
    # è®¤è¯ä¿¡æ¯
    # http_auth=('elastic', 'changeme')
)

# åŠ¨æ€è¿æ¥
es = Elasticsearch(
    ['esnode1:port', 'esnode2:port'],
    # åœ¨åšä»»ä½•æ“ä½œä¹‹å‰ï¼Œå…ˆè¿›è¡Œå—…æ¢
    sniff_on_start=True,
    # èŠ‚ç‚¹æ²¡æœ‰å“åº”æ—¶ï¼Œè¿›è¡Œåˆ·æ–°ï¼Œé‡æ–°è¿æ¥
    sniff_on_connection_fail=True,
    # æ¯ 60 ç§’åˆ·æ–°ä¸€æ¬¡
    sniffer_timeout=60
)

# ä¸åŒçš„èŠ‚ç‚¹ï¼Œèµ‹äºˆä¸åŒçš„å‚æ•°
es = Elasticsearch([
    {'host': 'localhost'},
    {'host': 'othernode', 'port': 443, 'url_prefix': 'es', 'use_ssl': True},
])

#å‡å¦‚ä½¿ç”¨äº† ssl
es = Elasticsearch(
    ['localhost:443', 'other_host:443'],
    # æ‰“å¼€SSL
    use_ssl=True,
    # ç¡®ä¿æˆ‘ä»¬éªŒè¯äº†SSLè¯ä¹¦ï¼ˆé»˜è®¤å…³é—­ï¼‰
    verify_certs=True,
    # æä¾›CAè¯ä¹¦çš„è·¯å¾„
    ca_certs='/path/to/CA_certs',
    # PEMæ ¼å¼çš„SSLå®¢æˆ·ç«¯è¯ä¹¦
    client_cert='/path/to/clientcert.pem',
    # PEMæ ¼å¼çš„SSLå®¢æˆ·ç«¯å¯†é’¥
    client_key='/path/to/clientkey.pem'
)
```

2ã€æµ‹è¯•é›†ç¾¤æ˜¯å¦å¯åŠ¨

``` Python
# æµ‹è¯•é›†ç¾¤æ˜¯å¦å¯åŠ¨
es.ping()
# è·å–é›†ç¾¤åŸºæœ¬ä¿¡æ¯
es.info()
# è·å–å½“å‰è¿æ¥çš„é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯
es.cluster.client.info()
# è·å–é›†ç¾¤ç›®å‰æ‰€æœ‰çš„ç´¢å¼•
es.cat.indices()
# è·å–é›†ç¾¤çš„æ›´å¤šä¿¡æ¯
es.cluster.stats()
# ä»»åŠ¡
es.tasks.get()
es.tasks.list()
```

### æŸ¥è¯¢

``` Python å‘èµ·æŸ¥è¯¢è¯·æ±‚
es = Elasticsearch(
        ['127.0.0.1:9201']
    )

response = es.search(
    index="logstash-2017.11.14", # ç´¢å¼•å
    body={             # è¯·æ±‚ä½“
      "query": {       # å…³é”®å­—ï¼ŒæŠŠæŸ¥è¯¢è¯­å¥ç»™ query
          "bool": {    # å…³é”®å­—ï¼Œè¡¨ç¤ºä½¿ç”¨ filter æŸ¥è¯¢ï¼Œæ²¡æœ‰åŒ¹é…åº¦
                "must": [      # è¡¨ç¤ºé‡Œé¢çš„æ¡ä»¶å¿…é¡»åŒ¹é…ï¼Œå¤šä¸ªåŒ¹é…å…ƒç´ å¯ä»¥æ”¾åœ¨åˆ—è¡¨é‡Œ
                    {
                        "match": {  # å…³é”®å­—ï¼Œè¡¨ç¤ºéœ€è¦åŒ¹é…çš„å…ƒç´ 
                            "TransId": '06100021650016153'   # TransId æ˜¯å­—æ®µåï¼Œ 06100021650016153 æ˜¯æ­¤å­—æ®µéœ€è¦åŒ¹é…åˆ°çš„å€¼
                        }
                    },
                    {
                        "match": {
                            "Ds": '2017-05-06'
                        }
                    },
                    {
                        "match": {
                            "Gy": '2012020235'
                        }
                    }, ],
                 "must_not": {   # å…³é”®å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢çš„ç»“æœé‡Œå¿…é¡»ä¸åŒ¹é…é‡Œé¢çš„å…ƒç´ 
                        "match": {  # å…³é”®å­—
                            "message": "M("    # message å­—æ®µåï¼Œè¿™ä¸ªå­—æ®µçš„å€¼ä¸€èˆ¬æ˜¯æŸ¥è¯¢åˆ°çš„ç»“æœå†…å®¹ä½“ã€‚è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œè¿”å›çš„ç»“æœé‡Œä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ 'M('
                        }
                 }
            }
        },

        # ä¸‹é¢æ˜¯å¯¹è¿”å›çš„ç»“æœç»§ç»­æ’åº
        "sort": [{"@timestamp": {"order": "desc"}}],
        "from": start,  # ä»åŒ¹é…åˆ°çš„ç»“æœä¸­çš„ç¬¬å‡ æ¡æ•°æ®å¼€å§‹è¿”å›ï¼Œå€¼æ˜¯åŒ¹é…åˆ°çš„æ•°æ®çš„ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹
        "size": size    # è¿”å›å¤šå°‘æ¡æ•°æ®
      }
)
```

### é«˜çº§æ¨¡å—

``` Python
es = Elasticsearch(
        ['172.16.153.129:9200']
    )
s = Search(using=es,
    index="logstash-2017.11.14").filter("match",Gy='20160521491').query("match", TransId='06100021650016153').exclude("match", message="M(")

response = s.execute()


usingï¼šæŒ‡æ˜ç”¨é‚£ä¸ªå·²ç»è¿æ¥çš„å¯¹è±¡
queryï¼šæ¥æ”¶çš„æ˜¯æŸ¥è¯¢ä½“è¯­å¥
excludeï¼šæ¥æ”¶çš„æ˜¯ä¸åŒ¹é…çš„å­—æ®µ å°±åƒ must_not

filterï¼šæ¥æ”¶çš„æ˜¯è¿‡æ»¤è¯­å¥ ï¼Œè¿‡æ»¤çš„æ¡ä»¶æ„æ€æ˜¯åœ¨è¿”å›ç»“æœä¸­æœ‰è¿™äº›æ¡ä»¶çš„ä¿¡æ¯
```

### elasticsearch-dsl

DSLï¼šDomain Specified Languageï¼Œç‰¹å®šé¢†åŸŸçš„è¯­è¨€

æ›´åŠ é€‚åˆç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨ï¼Œå¯ä»¥æ„å»ºå¤æ‚çš„æŸ¥è¯¢

### bulk æ‰¹é‡å­˜å‚¨

``` Python
from elasticsearch import helpers

datas = (
        {
            "_index": "topic",
            "_type": "_doc",
            "_source": {
                'id': item['_id'],
                "number" : item['number'],
                "forLevel" : item['forLevel'],
                "knowledge" : item['knowledge'],
                "difficulty" : item['difficulty'],
                "type" : item['type'],
                "title" : item['title'],
                "analysis" : item['analysis'],
                "accuracy" : item['accuracy'],
                "creatorId" : item['creatorId'],
                "eCode" : item['eCode'],
                "createTime" : item['createTime'].strftime('%Y-%m-%d %H:%M:%S'),
                "modifyTime" : item['modifyTime'].strftime('%Y-%m-%d %H:%M:%S') if item['modifyTime'] else item['createTime'].strftime('%Y-%m-%d %H:%M:%S'),
                "options": item['options']
            }
        } for item in res)
    now = time()
    print(now)
    helpers.bulk(es, datas)
```

### ä¸´æ—¶æ”¹å˜æŸ¥è¯¢çš„æœ€å¤§æ¡ç›®

é»˜è®¤å€¼æ˜¯ 10000 æ¡

``` Python
GET topic/_settings
{
  "index: {
    "max_result_window": "20000"
  }
}

# å¤„ç†å®Œä¹‹åå†ä¿®æ”¹è¿‡æ¥
GET topic/_settings
{
  "index: {
    "max_result_window": "10000"
  }
}
```

## linux

### linux ç¯å¢ƒä¸‹é…ç½® es ç›¸å…³ç¯å¢ƒ

REFER: https://www.cnblogs.com/Neeo/articles/10840096.html
