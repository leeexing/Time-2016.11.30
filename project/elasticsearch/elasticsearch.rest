@hostname = localhost
@port = 9200
@Authorization = eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1NzkyMjEwNzMsIm5iZiI6MTU3OTIyMTA3MywianRpIjoiOGRkMmU4N2UtOGZhMS00ZDQ0LTg0YTctYzc0ZjAwNjk4MDcxIiwiZXhwIjoxNTc5ODI1ODczLCJpZGVudGl0eSI6eyJ1c2VySUQiOjEsInVzZXJuYW1lIjoiYWRtaW4iLCJ1c2VydHlwZSI6MX0sImZyZXNoIjpmYWxzZSwidHlwZSI6ImFjY2VzcyJ9.ldnpLWBNdGw1p4nfo-N3HIJQN9OITcWWE62pzCkSZ5s
@contentType = application/json


### åˆ›å»ºç´¢å¼• ï¼ˆdatabaseï¼‰
PUT http://{{hostname}}:{{port}}/blog
User-Agent: vscode-restclient
Content-Type: {{contentType}}
# article ç›¸å½“äº type è¡¨ç›¸å½“äº type è¡¨
# properties ç›¸å½“äº æ–‡æ¡£ document çš„ å±æ€§ filed
# è¸©å‘ https://www.cnblogs.com/feiquan/p/11888812.html

{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  },
  "mappings": {
    "properties": {
      "id": {
        "type": "long",
        "store": true
      },
      "title": {
        "type": "text",
        "store": true,
        "index": true,
        "analyzer": "standard"
      },
      "content": {
        "type": "text",
        "store": true,
        "index": true,
        "analyzer": "standard"
      }
    }
  }
}


### è·å–ç”¨æˆ·åˆ—è¡¨ ï¼ˆæ—§çš„å†™æ³•ï¼‰
PUT http://{{hostname}}:{{port}}/blog?include_type_name=true
Authorization: Bearer {{Authorization}}

{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  },
  "mappings": {
    "article": {
      "properties": {
        "id": {
          "type": "long",
          "store": true
        },
        "title": {
          "type": "text",
          "store": true,
          "index": true,
          "analyzer": "standard"
        },
        "content": {
          "type": "text",
          "store": true,
          "index": true,
          "analyzer": "standard"
        }
      }
    }
  }
}

### è®¾ç½® index-hello ä¸­å…·ä½“çš„ type ä¿¡æ¯
POST http://{{hostname}}:{{port}}/index-hello/hello/_mappings
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "hello": {
    "id": {
      "type": "long",
      "store": true
    },
    "title": {
      "type": "text",
      "store": true,
      "index": true,
      "analyzer": "standard"
    },
    "content": {
      "type": "text",
      "store": true,
      "index": true,
      "analyzer": "standard"
    }
  }
}


### åˆ›å»ºdocument
POST http://{{hostname}}:{{port}}/blog/_doc/3
Authorization: Bearer {{Authorization}}
Content-Type: {{contentType}}

{
  "id": 3,
  "title": "åœ¨å®¶åŠå…¬",
  "content": "æ³¨æ„ï¼Œä¸Šé¢çš„ group_by_word_count è¡¨ç¤ºè¯¥èšåˆçš„åç§°ï¼Œæ˜¯è‡ªå®šä¹‰çš„ï¼Œå¯ä»¥è‡ªå·±ä¸ºè¯¥èšåˆå‘½åã€‚"
}


### æŸ¥è¯¢ï¼ˆæ ‡å‡†ï¼šåªèƒ½æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œä¸¤ä¸ªå°±ä¸è¡Œï¼‰
POST http://{{hostname}}:{{port}}/blog/_doc/_search
Content-Type: {{contentType}}

{
  "query": {
    "term": {
      "content": "å½“"
    }
  }
}


### æŸ¥è¯¢ï¼ˆå…³é”®è¯ï¼šå¯ä»¥æ˜¯å¤šä¸ªå­—ç¬¦ä¸²ï¼‰
POST http://{{hostname}}:{{port}}/blog/_doc/_search
Content-Type: {{contentType}}

{
  "query": {
    "query_string": {
      "default_field": "content",
      "query": "å¤§è§„æ¨¡"
    }
  }
}


### æŸ¥çœ‹åˆ†è¯ç»“æœ (v7ç‰ˆæœ¬æœ‰å˜åŒ–). é»˜è®¤æ˜¯ standardã€‚å¯ä»¥å®‰è£… ikã€‚ä½¿ç”¨ ik_smart | ik_max_word
POST http://{{hostname}}:{{port}}/_analyze
Content-Type: {{contentType}}

{
  "analyzer": "ik_smart",
  "text": "ç«¯æ­£åå§¿ï¼Œå¥½å¥½ä¸Šç­"
}


### æ·»åŠ ä¿®æ”¹æ•°æ®
POST http://{{hostname}}:{{port}}/people/_doc/4
Content-Type: {{contentType}}

{
  "name" : "å°ç”·",
  "age" : 22,
  "sex": "ç”·"
}


### è·å–æ•°æ®
GET http://{{hostname}}:{{port}}/people/_doc/2
Content-Type: {{contentType}}


### æŸ¥è¯¢æ‰€æœ‰
GET http://{{hostname}}:{{port}}/people/_search
Content-Type: {{contentType}}


### åŒ¹é…æŸ¥è¯¢
GET http://{{hostname}}:{{port}}/people/_search
Content-Type: {{contentType}}

{
  "query": {
    "match": {
      "sex": "ç”·"
    }
  }
}


### è¯æ¡åŒ¹é…ï¼ˆç²¾ç¡®æŸ¥æ‰¾ï¼‰ term è¢«ç”¨äºç²¾ç¡®å€¼ åŒ¹é…ã€‚ ä½¿ç”¨åªèƒ½æ˜¯ termï¼š{"sex": "ç”·"} ä¸èƒ½æ˜¯æ•°ç»„
### _source ç”¨äºè¿‡æ»¤å­—æ®µ
GET http://{{hostname}}:{{port}}/people/_search
Content-Type: {{contentType}}

{
  "query": {
    "terms": {
      "sex": ["ç”·", "å¥³"]
    }
  },
  "_source": "name"
}


###  NOTE:  ç¬¬äºŒéƒ¨åˆ†ï¼šé›†ç¾¤

### ğŸˆé›†ç¾¤ï¼Œåˆ›å»ºç´¢å¼• æ˜ å°„
PUT http://{{hostname}}:9201/blog/_mapping
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "properties": {
    "id": {
      "type": "long",
      "store": true
    },
    "title": {
      "type": "text",
      "store": true,
      "analyzer": "ik_smart"
    },
    "content": {
      "type": "text",
      "store": true,
      "analyzer": "ik_smart"
    }
  }
}

### æ·»åŠ æ•°æ®
POST http://{{hostname}}:9201/blog/_doc/5
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "id": 5,
  "title": "å¿«é€’å…¬å¸",
  "content": "æ®å›½å®¶é‚®æ”¿å±€2019å¹´å‘å¸ƒçš„å¿«é€’å‘˜ç”Ÿå­˜ç°çŠ¶è°ƒæŸ¥æŠ¥å‘Š,76.31%çš„å¿«é€’å‘˜"
}

### æŸ¥è¯¢æ•°æ®
GET http://{{hostname}}:9201/blog/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "match_all": {}
  },
  "_source": "content",
  "size": 2
}


### å¤šå­—æ®µæŸ¥è¯¢æ•°æ®
GET http://{{hostname}}:9201/blog/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "multi_match": {
      "query": "å…¬å¸",
      "fields": ["title", "content"]
    }
  },
  "sort": [
    {"id": "desc"}
  ]
}


### æŸ¥è¯¢æ•°æ® æ·»åŠ è¿‡æ»¤æ¡ä»¶
GET http://{{hostname}}:9201/blog/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "bool": { // è¿™é‡Œéœ€è¦äº‹ bool ean
      "filter": {
        "range": {
          "id": {"gt": 2}
        }
      }
    }
  },
  "sort": [
    {"id": "desc"}
  ]
}


### å…¨æ–‡æ£€ç´¢ ï¼ˆfull-text searchï¼‰
GET http://{{hostname}}:9201/blog/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "match": {
      "content": "2æœˆ 11æ—¥"
    }
  },
  "sort": [
    {"id": "desc"}
  ]
}


### çŸ­è¯­æ£€ç´¢ ï¼ˆphrase searchï¼‰ï¼šè¦æ±‚è¾“å…¥çš„æœç´¢ä¸²ï¼Œå¿…é¡»åœ¨æŒ‡å®šçš„å­—æ®µæ–‡æœ¬ä¸­ï¼Œå®Œå…¨åŒ…å«ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ‰å¯ä»¥ç®—åŒ¹é…
GET http://{{hostname}}:9201/blog/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "match_phrase": {
      "content": "2æœˆ 10æ—¥ æ¨"
    }
  },
  "sort": [
    {"id": "desc"}
  ]
}


### é«˜äº®æ£€ç´¢
GET http://{{hostname}}:9201/blog/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "match": {
      "content": "2æœˆ"
    }
  },
  "highlight": {
    "fields": {
      "title": {}
    }
  }
}


### èšåˆæŸ¥è¯¢. å°†title fieldçš„fielddataå±æ€§è®¾ç½®ä¸ºtrue.
### REFER: https://blog.csdn.net/jacke121/article/details/85042223
### REFER: https://blog.csdn.net/aawmx123/article/details/88781262
GET http://{{hostname}}:9201/blog/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "size": 0,
  "query": {
    "match": {
      "content": "2æœˆ"
    }
  },
  "aggs": {
    "group_by_title": {
      "terms": {"field": "title.keyword"},
    },
    "aggs": {
      "all_tag": {
        "terms": {
          "field": "title"
        }
      }
    }
  }
}


### èšåˆæŸ¥è¯¢. è·å–æœ€å¤§å¹´é¾„
GET http://{{hostname}}:9201/people/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "size": 0,
  "query": {
    "match_all": {}
  },
  "aggs": {
    "max_age": {
      "max": {
        "field": "age"
      }
    }
  }
}


### èšåˆæŸ¥è¯¢. è·å–å¹´é¾„å’Œ
GET http://{{hostname}}:9201/people/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "size": 0,
  "query": {
    "match_all": {}
  },
  "aggs": {
    "sum_age": {
      "sum": {
        "field": "age"
      }
    }
  }
}


### èšåˆæŸ¥è¯¢. èŒƒå›´èšåˆ
GET http://{{hostname}}:9201/people/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "size": 0,
  "aggs": {
    "test_missing": {
      "histogram": {
        "field": "age",
        "interval": 5,
        "order": {
          "_key": "asc"
        }
      }
    }
  }
}


### èšåˆæŸ¥è¯¢. ğŸ‘è®¡ç®—æ¯ä¸ªæ€§åˆ«ä¸‹é¢çš„å¹³å‡å¹´é¾„ï¼Œå¹¶æŒ‰ å¹³å‡å¹´é¾„ å‡åºæ’åº
GET http://{{hostname}}:9201/people/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "size": 0,
  "aggs": {
    "test_age": {
      "terms": {
        "field": "sex",
        "size": 5,
        "order": {
          "avg_age": "asc"
        }
      },
      "aggs": {
        "avg_age": {
          "avg": {"field": "age"}
        }
      }
    }
  }
}


### èšåˆæŸ¥è¯¢. ğŸ‘æŒ‰ç…§æŒ‡å®šçš„ä»·æ ¼èŒƒå›´åŒºé—´è¿›è¡Œåˆ†ç»„ï¼Œç„¶åè®¡ç®—æ¯ä¸ªæ€§åˆ«ä¸‹é¢çš„å¹³å‡å¹´é¾„ï¼Œå¹¶æŒ‰ å¹³å‡å¹´é¾„ å‡åºæ’åº
### âŒæ³¨æ„åµŒå¥—å…³ç³»ã€‚ä¸è¦æ”¾åˆ°å¤–é¢å»äº†
GET http://{{hostname}}:9201/people/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "size": 0,
  "aggs": {
    "group_by_age": {
      "range": {
        "field": "age",
        "ranges": [
          {
            "from" : 0,
            "to": 20
          },
          {
            "from": 20,
            "to": 30
          },
          {
            "from": 30,
            "to": 40
          },
          {
            "from": 40,
            "to": 50
          }
        ]
      },
      "aggs": {
        "group_by_sex": {
          "terms": {
            "field": "sex"
          },
          "aggs": {
            "avg_age": {
              "avg": {"field": "age"}
            }
          }
        }
      }
    }
  }
}


### å±€éƒ¨æ›´æ–°æ•°æ®
POST http://{{hostname}}:9201/news/_doc/DlcmN3ABuA_ZBa0L5Jhm/_update
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "doc": {
    "tags": ["æ ¡å›­"],
    "views": 0
  }
}


### å±€éƒ¨æ›´æ–°æ•°æ®.æ·»åŠ åˆ°å­—ç¬¦ä¸²
POST http://{{hostname}}:9201/news/_doc/DlcmN3ABuA_ZBa0L5Jhm/_update
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "script": {
    "source": "ctx._source.title += (params.new_title)",
    "params": {
      "new_title": "ã€‚æ¹–å—å¤§å­¦"
    }
  }
}


### å±€éƒ¨æ›´æ–°æ•°æ®.ä½¿ç”¨è„šæœ¬æ›´æ–°
POST http://{{hostname}}:9201/news/_doc/DlcmN3ABuA_ZBa0L5Jhm/_update
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "script": "ctx._source.views+=1"
}


### å±€éƒ¨æ›´æ–°æ•°æ®.å¾€æ•°ç»„é‡ŒåŠ å­—ç¬¦ä¸²
### REFER: https://blog.csdn.net/z457181562/article/details/93470152
POST http://{{hostname}}:9201/news/_doc/DlcmN3ABuA_ZBa0L5Jhm/_update
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "script": {
    "source": "ctx._source.tags.add(params.new_tag)",
    "params": {
      "new_tag": "è½¦è¾†"
    }
  }
}



### TIP:  ğŸ‘æŸ¥è¯¢æ•°æ®é‡Œé¢çš„å¯¹è±¡
GET http://{{hostname}}:9201/topic/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "nested": {
      "path": "options",
      "query": {
        "match": {
          "options.title": "å¯ç‡ƒç‰©"
        }
      }
    }
  }
}


### æµ‹è¯•
GET http://{{hostname}}:9201/topic/_search
User-Agent: vscode-restclient
Content-Type: {{contentType}}

{
  "query": {
    "range": {
      "createTime": {
        "gt": "2018-09-07 08:28:13",
        "lt": "2018-10-07 08:28:13"
      }
    }
  }
}